{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
       
    .sidebar {
  height: 100%; /* Full-height: remove this if you want "auto" height */
  width: 160px; /* Set the width of the sidebar */
  position: fixed; /* Fixed Sidebar (stay in place on scroll) */
  z-index: 1030; /* Stay on top */
  top: 0; /* Stay at the top */
  left: 0;
  right:0;
  background-color: #111; /* Black */
  overflow-x: hidden; /* Disable horizontal scroll */
  padding-top: 20px;
}
    </style>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Location</title>
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
        <script type='text/javascript'>
    var map,infobox, searchManager,str='Your Searched Results: ',places=[],studentval =[],locations=[],old=0;

function onlyUnique(value, index, self) { 
    return self.indexOf(value) === index;
}

    function GetMap() {
        map = new Microsoft.Maps.Map('#myMap', {
            credentials: 'Ak1Niz5T-7wp9lrVRb1kGtNm46vCML3OAkAiAL_7mPQWFe2N253Jw5E5lDl2y0kK'
        });

        //Create an infobox at the center of the map but don't show it.

    }
        function showval(){

            for (var i = 0; i < places.length; i++) {
                        console.log(places[i]);
                    }
        for (var i = 0; i < studentval.length; i++) {
          console.log(studentval[i]);
          //alert(studentval[i].value)
        }            
        }
    
    function clear(){
            map.clear();
    }

    function Optimize(){

        var rand1 = locations[Math.floor(Math.random() * locations.length)];
        var rand2;
        while(1){
         rand2 = locations[Math.floor(Math.random() * locations.length)];
        if(rand1!=rand2)break;
        }
            alert(rand1+" "+rand2);
           
    }
    function Student() {
        document.getElementById("showbtn").style.display = "block";
        alert('No of studens: '+document.getElementById('studentval').value);
        studentval.push(document.getElementById('studentval').value);
        document.getElementById("student").style.display = "none";
        //console.log(school.value);
    }

    function Search() {
        document.getElementById("showbtn2").style.display = "block";
        document.getElementById('studentval').value="";
        if (!searchManager) {
            //Create an instance of the search manager and perform the search.
            Microsoft.Maps.loadModule('Microsoft.Maps.Search', function () {
                searchManager = new Microsoft.Maps.Search.SearchManager(map);
                Search()
            });
        } else {
            //Remove any previous results from the map.
            //map.entities.clear();

            //Get the users query and geocode it.
            var query = document.getElementById('searchTbx').value;
            geocodeQuery(query);
        }
    }

    function geocodeQuery(query) {
        
        var searchRequest = {

            where: query,
            callback: function (r) {
                document.getElementById("student").style.display = "block";
                if (r && r.results && r.results.length > 0) {
                    var pin, pins = [], locs = [], output = 'Results:<br/>';
                    
                        infobox = new Microsoft.Maps.Infobox(map.getCenter(), {
                        visible: false
                        });
                        infobox.setMap(map);
   
                    for (var i = 0; i < r.results.length; i++) {
                        //Create a pushpin for each result. 
                        var x=i+old+1;
                        pin = new Microsoft.Maps.Pushpin(r.results[i].location,{ text: x+""});
                        
                         pin.metadata = {
                          title: 'Pin ' + x,
                          description: 'Discription for pin' + x
                        };

                        Microsoft.Maps.Events.addHandler(pin, 'click', pushpinClicked);

                        
                        
                        pins.push(pin);
                        //alert("Pin "+pin);
                        //alert("Loca "+r.results[i].location);
                        locs.push(r.results[i].location);
                        var a = r.results[0].name;
                        a=a.split(",")[0];
                        places.push(a);
                        places=places.filter( onlyUnique );
                        //str+=' ,'+r.results[0].name+' ,';
                        
                        output += x + ') ' + r.results[i].name + '<br/>';
                    }
                    locations=locations.concat(locs);
                    old+=i;
                    
                    //Add the pins to the map
                    map.entities.push(pins);

                    //Display list of results
                    document.getElementById('output').innerHTML = output;

                    //Determine a bounding box to best view the results.
                    var bounds;
                    if (r.results.length == 1) {

                        //bounds = r.results[0].bestView;
                    bounds = Microsoft.Maps.LocationRect.fromLocations(locations);

                    } else {
                        //Use the locations from the results to calculate a bounding box.
                        bounds = Microsoft.Maps.LocationRect.fromLocations(locations);
                    }

                    map.setView({ bounds: bounds });
                }
            },
            errorCallback: function (e) {
                //If there is an error, alert the user about it.
                alert("No results found.");
            }
        };

        //Make the geocode request.
        searchManager.geocode(searchRequest);
    }

   function pushpinClicked(e) {
        //Make sure the infobox has metadata to display.
        if (e.target.metadata) {
            //Set the infobox options with the metadata of the pushpin.
            infobox.setOptions({
                location: e.target.getLocation(),
                title: e.target.metadata.title,
                visible: true
            });
        }
    }


    </script>
    <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap' async defer>
        
    </script>

  </head>
  <body>
    <input id='searchTbx' type='text'/> 
    <input type='button'value='Search' onclick='Search()'/>
    <br/>
    <div id="myMap" style="position:relative;width:65%;height:400px;float:left;"></div>
    <div id='output' style="margin-left:10px;float:left;">
    
      {% block content %}
      {% endblock %}
    </div>
<div class="container" id="sidebar">
</div>
    <script src="{% static 'js/jquery-3.1.1.min.js' %}"></script>  
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/plugin.js' %}"></script>
    {% block javascript %}
    {% endblock %}
  </body>
</html>